"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[snapshot]
# auto-track things EXCEPT in repo root where I keep putting junk files
auto-track = "glob:*/**/*"

[gerrit]
enabled = false

[templates]
commit_trailers = '''
if(
  config("gerrit.enabled").as_boolean() && !trailers.contains_key("Change-Id"),
  format_gerrit_change_id_trailer(self)
)
'''
draft_commit_description = '''
concat(
  coalesce(description, "", "\n"),
  surround(
    "\nJJ: This commit contains the following changes:\n", "",
    indent("JJ:     ", diff.stat(72)),
  ),
  "\nJJ: ignore-rest\n",
  diff.git(),
)
'''
git_push_bookmark = '"jade/push-" ++ change_id.short()'

[git]
private-commits = "description(glob:'wip:*') | description(glob:'private:*')"

[ui]
pager = "delta"
diff-formatter = ":git"

default-command = "log"

[aliases]
# jj jj jj commit
jj = []
l = ["log", "-r", "trunk():: & mine()"]
fetch = ["git", "fetch"]
fo = ["git", "fetch", "--remote", "origin"]
fj = ["git", "fetch", "--remote", "jade"]
po = ["git", "push", "--remote", "origin"]
pon = ["git", "push", "--remote", "origin", "--allow-new", "-b"]
pj = ["git", "push", "--remote", "jade"]
give = ['squash', '--use-destination-message', '--from', '@', '--into']
take = ['squash', '--use-destination-message', '--into', '@', '--from']
# pre-commit tool: https://github.com/jj-vcs/jj/issues/405#issuecomment-2744406580
check = [
  "util",
  "exec",
  "--",
  "bash",
  "-c",
  "jj diff -r @ --name-only --no-pager | xargs pre-commit run --files",
]

[revset-aliases]
# https://github.com/jj-vcs/jj/discussions/5669
'why_immutable(r)' = '(r & immutable()) | roots(r:: & immutable_heads())'

[user]
name = "Jade Lovelace"
email = "software@lfcode.ca"

[diff.color-words]
conflict = "pair"

[fix.tools.rustfmt]
command = ["rustfmt", "+nightly", "--emit", "stdout"]
patterns = ["glob:'**/*.rs'"]
enabled = false

[fix.tools.terraform-fmt]
command = ["terraform", "fmt", "-"]
patterns = ["glob:'**/*.tf'"]
enabled = true

[fix.tools.nixfmt-rfc-style]
command = ["nixfmt", "-"]
patterns = ["glob:'**/*.nix'"]
enabled = false

[fix.tools.keep-sorted]
command = ["keep-sorted", "-"]
enabled = true

[[--scope]]
--when.repositories = ["~/lix"]
[--scope.user]
email = "jade@lix.systems"
